###############################################################################
#
#    Licensed Materials - Property of IBM
#    "Restricted Materials of IBM"
#
#    5724-S44
#
#    (C) Copyright IBM Corp. 2005, 2012
#
#    Netcool Knowledge Library
#
###############################################################################
#
# Draft rules for VMWare ESXi 5.0/5.1 Integration.
#
###############################################################################
#
# 1.0 - Initial Release.
#
#        Compatible with:
#
#          -  Netcool/Omnibus 3.x and 7
#          -  Netcool Rules File Standards (MUSE-STD-RF-03, Jan 2006)
#
#          -  VMWARE-ENV-MIB , VMWARE-VMINFO-MIB
#
###############################################################################

case ".1.3.6.1.4.1.6876": ### - Notifications from VMWARE-ENV-MIB (201005120000Z)

	log(DEBUG, "<<<<< Entering... vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB.include.snmptrap.rules >>>>>")

    @Agent = "vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB"
    @Class = "3360"
    
    $OPTION_TypeFieldUsage = "3.6"

    switch($specific-trap)
    {
    
     
        case "301": ### vmwEnvHardwareEvent
        
			discard
         
        default:

            @Summary = "Unknown Specific Trap Number (" + $specific-trap + ") Received for Enterprise " + $enterprise
            @Severity = 1
            @Identifier = @Node + " " + @Agent + " " + @Manager + " " + $enterprise + " " + $generic-trap + " " + $specific-trap
            details($*)
    }

##########
# Handle Severity via Lookup.
##########

if(exists($SEV_KEY))
{
    [$OS_Severity,$OS_Type,$OS_ExpireTime] = lookup($SEV_KEY, vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB_sev)
}
else
{
    [$OS_Severity,$OS_Type,$OS_ExpireTime] = lookup($OS_EventId, vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB_sev)
}
include "$NC_RULES_HOME/include-common/AssignSev.include.common.rules"

##########
# End of Severity via Lookup.
##########

##########
# Enter "Advanced" and "User" includes.
##########


include "$NC_RULES_HOME/include-snmptrap/vmware/vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwNotifications.adv.include.snmptrap.rules"
include "$NC_RULES_HOME/include-snmptrap/vmware/vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwNotifications.user.include.snmptrap.rules"


##########
# End of "Advanced" and "User" includes.
##########

include "$NC_RULES_HOME/include-common/load_include.rules"

log(DEBUG, "<<<<< Leaving... vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB.include.snmptrap.rules >>>>>")


case ".1.3.6.1.4.1.6876.4.1": ### - Notifications from VMWARE-ENV-MIB (201005120000Z)
                              ### - Notifications from VMWARE-VMINFO-MIB (201109170000Z)

	log(DEBUG, "<<<<< Entering... vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB.include.snmptrap.rules >>>>>")

    @Agent = "vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB"
    @Class = "3360"
    
    $OPTION_TypeFieldUsage = "3.6"

    switch($specific-trap)
    {
	    
     
        case "1": ### vmwVmPoweredOn
        
            ##########
            # $1 = vmwVmID
            # $2 = vmwVmConfigFilePath
            # $3 = vmwVmDisplayName
            ##########
            
            $vmwVmID = $1
            $vmwVmConfigFilePath = $2
            $vmwVmDisplayName = $3
            
            $vmwVmIdx = extract($OID3, "\.([0-9]+)$")
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwVmPoweredOn"

            @AlertGroup = "Virtual Machine Status"
            @AlertKey = "vmwVmEntry." + $vmwVmDisplayName
            @Summary = "Virtual Machine " + $vmwVmDisplayName + " Powered On ( vmwVmIdx: " + $vmwVmIdx + " ) "
            $OS_Service = $vmwVmDisplayName
            
            $DEFAULT_Severity = 1
            $DEFAULT_Type = 2
            $DEFAULT_ExpireTime = 0               
            
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
 			details($vmwVmID, $vmwVmConfigFilePath, $vmwVmDisplayName, $vmwVmIdx)
         
        case "2": ### vmwVmPoweredOff
        
            ##########
            # $1 = vmwVmID
            # $2 = vmwVmConfigFilePath
            # $3 = vmwVmDisplayName
            ##########
            
            $vmwVmID = $1
            $vmwVmConfigFilePath = $2
            $vmwVmDisplayName = $3

            $vmwVmIdx = extract($OID3, "\.([0-9]+)$")
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwVmPoweredOff"

            @AlertGroup = "Virtual Machine Status"
            @AlertKey = "vmwVmEntry." + $vmwVmDisplayName
            @Summary = "Virtual Machine " + $vmwVmDisplayName + " Powered Off ( vmwVmIdx: " + $vmwVmIdx + " ) "
            $OS_Service = $vmwVmDisplayName
           
            $DEFAULT_Severity = 3
            $DEFAULT_Type = 1
            $DEFAULT_ExpireTime = 0               
            
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
 			details($vmwVmID, $vmwVmConfigFilePath, $vmwVmDisplayName, $vmwVmIdx)
         
        case "3": ### vmwVmHBLost
        
            ##########
            # $1 = vmwVmID
            # $2 = vmwVmConfigFilePath
            # $3 = vmwVmDisplayName
            ##########
            
            $vmwVmID = $1
            $vmwVmConfigFilePath = $2
            $vmwVmDisplayName = $3
            
            $vmwVmIdx = extract($OID3, "\.([0-9]+)$")
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwVmHBLost"

            @AlertGroup = "Virtual Machine Status"
            @AlertKey = "vmwVmHBEntry." + $vmwVmDisplayName
            @Summary = "Virtual Machine " + $vmwVmDisplayName + " Detected A Loss In Guest Heartbeat ( vmwVmIdx: " + $vmwVmIdx + " ) "
            $OS_Service = $vmwVmDisplayName
           
            $DEFAULT_Severity = 3
            $DEFAULT_Type = 1
            $DEFAULT_ExpireTime = 0               
            
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
 			details($vmwVmID, $vmwVmConfigFilePath, $vmwVmDisplayName, $vmwVmIdx)
         
        case "4": ### vmwVmHBDetected
        
            ##########
            # $1 = vmwVmID
            # $2 = vmwVmConfigFilePath
            # $3 = vmwVmDisplayName
            ##########
            
            $vmwVmID = $1
            $vmwVmConfigFilePath = $2
            $vmwVmDisplayName = $3
            
            $vmwVmIdx = extract($OID3, "\.([0-9]+)$")
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwVmHBDetected"

            @AlertGroup = "Virtual Machine Status"
            @AlertKey = "vmwVmHBEntry." + $vmwVmDisplayName
            @Summary = "Virtual Machine " + $vmwVmDisplayName + " Regains The Required Number Of Guest Heartbeats ( vmwVmIdx: " + $vmwVmIdx + " ) "
            $OS_Service = $vmwVmDisplayName
           
            $DEFAULT_Severity = 1
            $DEFAULT_Type = 2
            $DEFAULT_ExpireTime = 0               
            
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
 			details($vmwVmID, $vmwVmConfigFilePath, $vmwVmDisplayName, $vmwVmIdx)
         
        case "5": ### vmwVmSuspended
        
            ##########
            # $1 = vmwVmID
            # $2 = vmwVmConfigFilePath
            # $3 = vmwVmDisplayName
            ##########
            
            $vmwVmID = $1
            $vmwVmConfigFilePath = $2
            $vmwVmDisplayName = $3

            $vmwVmIdx = extract($OID3, "\.([0-9]+)$")
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwVmSuspended"

            @AlertGroup = "Virtual Machine Status"
            @AlertKey = "vmwVmEntry." + $vmwVmDisplayName
            @Summary = "Virtual Machine " + $vmwVmDisplayName + " Suspended ( vmwVmIdx: " + $vmwVmIdx + " ) "
            $OS_Service = $vmwVmDisplayName
            
            $DEFAULT_Severity = 3
            $DEFAULT_Type = 1
            $DEFAULT_ExpireTime = 0               
            
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
 			details($vmwVmID, $vmwVmConfigFilePath, $vmwVmDisplayName, $vmwVmIdx)
             
     
        case "301": ### vmwESXEnvHardwareEvent
        
			discard
         
        case "302": ### vmwESXEnvHardwareAlert
        
            ##########
            # $1 = vmwEnvDescription
            # $2 = vmwEnvEventTime
            # $3 = vmwEnvIndicationTime
            # $4 = vmwEnvPerceivedSeverity
            # $5 = vmwEnvAlertType
            # $6 = vmwEnvSysCreationClassName
            # $7 = vmwEnvAlertingElement
            # $8 = vmwEnvAlertingFormat
            # $9 = vmwEnvSystemName
            # $10 = vmwEnvProviderName
            ##########
            
            $vmwEnvDescription = $1
            $vmwEnvEventTime = $2
            $vmwEnvIndicationTime = $3
            $vmwEnvPerceivedSeverity = lookup($4, VmwCIMSeverity)
            $vmwEnvAlertType = lookup($5, VmwCIMAlertTypes)
            $vmwEnvSysCreationClassName = $6
            $vmwEnvAlertingElement = $7
            $vmwEnvAlertingFormat = lookup($8, VmwCIMAlertFormat)
            $vmwEnvSystemName = $9
            $vmwEnvProviderName = $10
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXEnvHardwareAlert"

            @AlertGroup = "Hardware Alert"
            @AlertKey = "ID : " + $vmwEnvAlertingElement
            @Summary = "Hardware Alert from CIM, Type: " + $vmwEnvAlertType + "," + "Description: " + $vmwEnvDescription + " ( " + @AlertKey + " ) "
            
            switch($4)
            {
                case "0":### unknown
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "1":### other
                    $SEV_KEY = $OS_EventId + "_other"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "2":### information
                    $SEV_KEY = $OS_EventId + "_information"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 13
                    $DEFAULT_ExpireTime = 1800               
                case "3":### warning
                    $SEV_KEY = $OS_EventId + "_warning"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "4":### minor
                    $SEV_KEY = $OS_EventId + "_minor"
                    $DEFAULT_Severity = 3
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "5":### major
                    $SEV_KEY = $OS_EventId + "_major"
                    $DEFAULT_Severity = 4
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "6":### critical
                    $SEV_KEY = $OS_EventId + "_critical"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "7":### fatal
                    $SEV_KEY = $OS_EventId + "_fatal"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                default: 
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0
            }
                     
			update(@Severity)
			
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
            $vmwEnvPerceivedSeverity = $vmwEnvPerceivedSeverity + " ( " + $4 + " )"
            $vmwEnvAlertType = $vmwEnvAlertType + " ( " + $5 + " )"
            $vmwEnvAlertingFormat = $vmwEnvAlertingFormat + " ( " + $8 + " )"
 			details($vmwEnvDescription, $vmwEnvEventTime, $vmwEnvIndicationTime, $vmwEnvPerceivedSeverity, $vmwEnvAlertType, $vmwEnvSysCreationClassName, $vmwEnvAlertingElement, $vmwEnvAlertingFormat, $vmwEnvSystemName, $vmwEnvProviderName)
         
        case "303": ### vmwESXEnvBatteryAlert
        
            ##########
            # $1 = vmwEnvDescription
            # $2 = vmwEnvEventTime
            # $3 = vmwEnvIndicationTime
            # $4 = vmwEnvPerceivedSeverity
            # $5 = vmwEnvAlertType
            # $6 = vmwEnvSysCreationClassName
            # $7 = vmwEnvAlertingElement
            # $8 = vmwEnvAlertingFormat
            # $9 = vmwEnvSystemName
            # $10 = vmwEnvProviderName
            ##########
            
            $vmwEnvDescription = $1
            $vmwEnvEventTime = $2
            $vmwEnvIndicationTime = $3
            $vmwEnvPerceivedSeverity = lookup($4, VmwCIMSeverity)
            $vmwEnvAlertType = lookup($5, VmwCIMAlertTypes)
            $vmwEnvSysCreationClassName = $6
            $vmwEnvAlertingElement = $7
            $vmwEnvAlertingFormat = lookup($8, VmwCIMAlertFormat)
            $vmwEnvSystemName = $9
            $vmwEnvProviderName = $10
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXEnvBatteryAlert"

            @AlertGroup = "Battery Alert"
            @AlertKey = "ID : " + $vmwEnvAlertingElement
            @Summary = "Battery Alert from CIM, Type: " + $vmwEnvAlertType + "," + "Description: " + $vmwEnvDescription + " ( " + @AlertKey + " ) "
            
            switch($4)
            {
                case "0":### unknown
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "1":### other
                    $SEV_KEY = $OS_EventId + "_other"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "2":### information
                    $SEV_KEY = $OS_EventId + "_information"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 13
                    $DEFAULT_ExpireTime = 1800               
                case "3":### warning
                    $SEV_KEY = $OS_EventId + "_warning"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "4":### minor
                    $SEV_KEY = $OS_EventId + "_minor"
                    $DEFAULT_Severity = 3
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "5":### major
                    $SEV_KEY = $OS_EventId + "_major"
                    $DEFAULT_Severity = 4
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "6":### critical
                    $SEV_KEY = $OS_EventId + "_critical"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "7":### fatal
                    $SEV_KEY = $OS_EventId + "_fatal"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                default: 
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0
            }
                     
			update(@Severity)
			
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
            $vmwEnvPerceivedSeverity = $vmwEnvPerceivedSeverity + " ( " + $4 + " )"
            $vmwEnvAlertType = $vmwEnvAlertType + " ( " + $5 + " )"
            $vmwEnvAlertingFormat = $vmwEnvAlertingFormat + " ( " + $8 + " )"
 			details($vmwEnvDescription, $vmwEnvEventTime, $vmwEnvIndicationTime, $vmwEnvPerceivedSeverity, $vmwEnvAlertType, $vmwEnvSysCreationClassName, $vmwEnvAlertingElement, $vmwEnvAlertingFormat, $vmwEnvSystemName, $vmwEnvProviderName)
         
        case "304": ### vmwESXEnvChassisAlert
        
            ##########
            # $1 = vmwEnvDescription
            # $2 = vmwEnvEventTime
            # $3 = vmwEnvIndicationTime
            # $4 = vmwEnvPerceivedSeverity
            # $5 = vmwEnvAlertType
            # $6 = vmwEnvSysCreationClassName
            # $7 = vmwEnvAlertingElement
            # $8 = vmwEnvAlertingFormat
            # $9 = vmwEnvSystemName
            # $10 = vmwEnvProviderName
            ##########
            
            $vmwEnvDescription = $1
            $vmwEnvEventTime = $2
            $vmwEnvIndicationTime = $3
            $vmwEnvPerceivedSeverity = lookup($4, VmwCIMSeverity)
            $vmwEnvAlertType = lookup($5, VmwCIMAlertTypes)
            $vmwEnvSysCreationClassName = $6
            $vmwEnvAlertingElement = $7
            $vmwEnvAlertingFormat = lookup($8, VmwCIMAlertFormat)
            $vmwEnvSystemName = $9
            $vmwEnvProviderName = $10
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXEnvChassisAlert"

            @AlertGroup = "Chassis Alert"
            @AlertKey = "ID : " + $vmwEnvAlertingElement
            @Summary = "Chassis Alert from CIM, Type: " + $vmwEnvAlertType + "," + "Description: " + $vmwEnvDescription + " ( " + @AlertKey + " ) "
            
            switch($4)
            {
                case "0":### unknown
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "1":### other
                    $SEV_KEY = $OS_EventId + "_other"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "2":### information
                    $SEV_KEY = $OS_EventId + "_information"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 13
                    $DEFAULT_ExpireTime = 1800               
                case "3":### warning
                    $SEV_KEY = $OS_EventId + "_warning"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "4":### minor
                    $SEV_KEY = $OS_EventId + "_minor"
                    $DEFAULT_Severity = 3
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "5":### major
                    $SEV_KEY = $OS_EventId + "_major"
                    $DEFAULT_Severity = 4
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "6":### critical
                    $SEV_KEY = $OS_EventId + "_critical"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "7":### fatal
                    $SEV_KEY = $OS_EventId + "_fatal"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                default: 
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0
            }
                     
			update(@Severity)
			
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
            $vmwEnvPerceivedSeverity = $vmwEnvPerceivedSeverity + " ( " + $4 + " )"
            $vmwEnvAlertType = $vmwEnvAlertType + " ( " + $5 + " )"
            $vmwEnvAlertingFormat = $vmwEnvAlertingFormat + " ( " + $8 + " )"
 			details($vmwEnvDescription, $vmwEnvEventTime, $vmwEnvIndicationTime, $vmwEnvPerceivedSeverity, $vmwEnvAlertType, $vmwEnvSysCreationClassName, $vmwEnvAlertingElement, $vmwEnvAlertingFormat, $vmwEnvSystemName, $vmwEnvProviderName)
         
        case "305": ### vmwESXEnvThermalAlert
        
            ##########
            # $1 = vmwEnvDescription
            # $2 = vmwEnvEventTime
            # $3 = vmwEnvIndicationTime
            # $4 = vmwEnvPerceivedSeverity
            # $5 = vmwEnvAlertType
            # $6 = vmwEnvSysCreationClassName
            # $7 = vmwEnvAlertingElement
            # $8 = vmwEnvAlertingFormat
            # $9 = vmwEnvSystemName
            # $10 = vmwEnvProviderName
            ##########
            
            $vmwEnvDescription = $1
            $vmwEnvEventTime = $2
            $vmwEnvIndicationTime = $3
            $vmwEnvPerceivedSeverity = lookup($4, VmwCIMSeverity)
            $vmwEnvAlertType = lookup($5, VmwCIMAlertTypes)
            $vmwEnvSysCreationClassName = $6
            $vmwEnvAlertingElement = $7
            $vmwEnvAlertingFormat = lookup($8, VmwCIMAlertFormat)
            $vmwEnvSystemName = $9
            $vmwEnvProviderName = $10
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXEnvThermalAlert"

            @AlertGroup = "Thermal Alert"
            @AlertKey = "ID : " + $vmwEnvAlertingElement
            @Summary = "Thermal Alert from CIM, Type: " + $vmwEnvAlertType + "," + "Description: " + $vmwEnvDescription + " ( " + @AlertKey + " ) "
            
            switch($4)
            {
                case "0":### unknown
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "1":### other
                    $SEV_KEY = $OS_EventId + "_other"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "2":### information
                    $SEV_KEY = $OS_EventId + "_information"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 13
                    $DEFAULT_ExpireTime = 1800               
                case "3":### warning
                    $SEV_KEY = $OS_EventId + "_warning"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "4":### minor
                    $SEV_KEY = $OS_EventId + "_minor"
                    $DEFAULT_Severity = 3
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "5":### major
                    $SEV_KEY = $OS_EventId + "_major"
                    $DEFAULT_Severity = 4
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "6":### critical
                    $SEV_KEY = $OS_EventId + "_critical"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "7":### fatal
                    $SEV_KEY = $OS_EventId + "_fatal"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                default: 
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0
            }
                     
			update(@Severity)
			
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
            $vmwEnvPerceivedSeverity = $vmwEnvPerceivedSeverity + " ( " + $4 + " )"
            $vmwEnvAlertType = $vmwEnvAlertType + " ( " + $5 + " )"
            $vmwEnvAlertingFormat = $vmwEnvAlertingFormat + " ( " + $8 + " )"
 			details($vmwEnvDescription, $vmwEnvEventTime, $vmwEnvIndicationTime, $vmwEnvPerceivedSeverity, $vmwEnvAlertType, $vmwEnvSysCreationClassName, $vmwEnvAlertingElement, $vmwEnvAlertingFormat, $vmwEnvSystemName, $vmwEnvProviderName)
         
        case "306": ### vmwESXEnvDiskAlert
        
            ##########
            # $1 = vmwEnvDescription
            # $2 = vmwEnvEventTime
            # $3 = vmwEnvIndicationTime
            # $4 = vmwEnvPerceivedSeverity
            # $5 = vmwEnvAlertType
            # $6 = vmwEnvSysCreationClassName
            # $7 = vmwEnvAlertingElement
            # $8 = vmwEnvAlertingFormat
            # $9 = vmwEnvSystemName
            # $10 = vmwEnvProviderName
            ##########
            
            $vmwEnvDescription = $1
            $vmwEnvEventTime = $2
            $vmwEnvIndicationTime = $3
            $vmwEnvPerceivedSeverity = lookup($4, VmwCIMSeverity)
            $vmwEnvAlertType = lookup($5, VmwCIMAlertTypes)
            $vmwEnvSysCreationClassName = $6
            $vmwEnvAlertingElement = $7
            $vmwEnvAlertingFormat = lookup($8, VmwCIMAlertFormat)
            $vmwEnvSystemName = $9
            $vmwEnvProviderName = $10
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXEnvDiskAlert"

            @AlertGroup = "Disk Alert"
            @AlertKey = "ID : " + $vmwEnvAlertingElement
            @Summary = "Disk Alert from CIM, Type: " + $vmwEnvAlertType + "," + "Description: " + $vmwEnvDescription + " ( " + @AlertKey + " ) "
            
            switch($4)
            {
                case "0":### unknown
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "1":### other
                    $SEV_KEY = $OS_EventId + "_other"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "2":### information
                    $SEV_KEY = $OS_EventId + "_information"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 13
                    $DEFAULT_ExpireTime = 1800               
                case "3":### warning
                    $SEV_KEY = $OS_EventId + "_warning"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "4":### minor
                    $SEV_KEY = $OS_EventId + "_minor"
                    $DEFAULT_Severity = 3
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "5":### major
                    $SEV_KEY = $OS_EventId + "_major"
                    $DEFAULT_Severity = 4
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "6":### critical
                    $SEV_KEY = $OS_EventId + "_critical"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "7":### fatal
                    $SEV_KEY = $OS_EventId + "_fatal"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                default: 
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0
            }
                     
			update(@Severity)
			
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
            $vmwEnvPerceivedSeverity = $vmwEnvPerceivedSeverity + " ( " + $4 + " )"
            $vmwEnvAlertType = $vmwEnvAlertType + " ( " + $5 + " )"
            $vmwEnvAlertingFormat = $vmwEnvAlertingFormat + " ( " + $8 + " )"
 			details($vmwEnvDescription, $vmwEnvEventTime, $vmwEnvIndicationTime, $vmwEnvPerceivedSeverity, $vmwEnvAlertType, $vmwEnvSysCreationClassName, $vmwEnvAlertingElement, $vmwEnvAlertingFormat, $vmwEnvSystemName, $vmwEnvProviderName)
         
        case "307": ### vmwESXEnvPowerAlert
        
            ##########
            # $1 = vmwEnvDescription
            # $2 = vmwEnvEventTime
            # $3 = vmwEnvIndicationTime
            # $4 = vmwEnvPerceivedSeverity
            # $5 = vmwEnvAlertType
            # $6 = vmwEnvSysCreationClassName
            # $7 = vmwEnvAlertingElement
            # $8 = vmwEnvAlertingFormat
            # $9 = vmwEnvSystemName
            # $10 = vmwEnvProviderName
            ##########
            
            $vmwEnvDescription = $1
            $vmwEnvEventTime = $2
            $vmwEnvIndicationTime = $3
            $vmwEnvPerceivedSeverity = lookup($4, VmwCIMSeverity)
            $vmwEnvAlertType = lookup($5, VmwCIMAlertTypes)
            $vmwEnvSysCreationClassName = $6
            $vmwEnvAlertingElement = $7
            $vmwEnvAlertingFormat = lookup($8, VmwCIMAlertFormat)
            $vmwEnvSystemName = $9
            $vmwEnvProviderName = $10
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXEnvPowerAlert"

            @AlertGroup = "Power Alert"
            @AlertKey = "ID : " + $vmwEnvAlertingElement
            @Summary = "Power Supply Alert from CIM, Type: " + $vmwEnvAlertType + "," + "Description: " + $vmwEnvDescription + " ( " + @AlertKey + " ) "
            
            switch($4)
            {
                case "0":### unknown
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "1":### other
                    $SEV_KEY = $OS_EventId + "_other"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "2":### information
                    $SEV_KEY = $OS_EventId + "_information"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 13
                    $DEFAULT_ExpireTime = 1800               
                case "3":### warning
                    $SEV_KEY = $OS_EventId + "_warning"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "4":### minor
                    $SEV_KEY = $OS_EventId + "_minor"
                    $DEFAULT_Severity = 3
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "5":### major
                    $SEV_KEY = $OS_EventId + "_major"
                    $DEFAULT_Severity = 4
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "6":### critical
                    $SEV_KEY = $OS_EventId + "_critical"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "7":### fatal
                    $SEV_KEY = $OS_EventId + "_fatal"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                default: 
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0
            }
                     
			update(@Severity)
			
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
            $vmwEnvPerceivedSeverity = $vmwEnvPerceivedSeverity + " ( " + $4 + " )"
            $vmwEnvAlertType = $vmwEnvAlertType + " ( " + $5 + " )"
            $vmwEnvAlertingFormat = $vmwEnvAlertingFormat + " ( " + $8 + " )"
 			details($vmwEnvDescription, $vmwEnvEventTime, $vmwEnvIndicationTime, $vmwEnvPerceivedSeverity, $vmwEnvAlertType, $vmwEnvSysCreationClassName, $vmwEnvAlertingElement, $vmwEnvAlertingFormat, $vmwEnvSystemName, $vmwEnvProviderName)
         
        case "308": ### vmwESXEnvProcessorAlert
        
            ##########
            # $1 = vmwEnvDescription
            # $2 = vmwEnvEventTime
            # $3 = vmwEnvIndicationTime
            # $4 = vmwEnvPerceivedSeverity
            # $5 = vmwEnvAlertType
            # $6 = vmwEnvSysCreationClassName
            # $7 = vmwEnvAlertingElement
            # $8 = vmwEnvAlertingFormat
            # $9 = vmwEnvSystemName
            # $10 = vmwEnvProviderName
            ##########
            
            $vmwEnvDescription = $1
            $vmwEnvEventTime = $2
            $vmwEnvIndicationTime = $3
            $vmwEnvPerceivedSeverity = lookup($4, VmwCIMSeverity)
            $vmwEnvAlertType = lookup($5, VmwCIMAlertTypes)
            $vmwEnvSysCreationClassName = $6
            $vmwEnvAlertingElement = $7
            $vmwEnvAlertingFormat = lookup($8, VmwCIMAlertFormat)
            $vmwEnvSystemName = $9
            $vmwEnvProviderName = $10
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXEnvProcessorAlert"

            @AlertGroup = "IPMI Processor Alert"
            @AlertKey = "ID : " + $vmwEnvAlertingElement
            @Summary = "IPMI Processor Alert from CIM, Type: " + $vmwEnvAlertType + "," + "Description: " + $vmwEnvDescription + " ( " + @AlertKey + " ) "
            
            switch($4)
            {
                case "0":### unknown
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "1":### other
                    $SEV_KEY = $OS_EventId + "_other"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "2":### information
                    $SEV_KEY = $OS_EventId + "_information"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 13
                    $DEFAULT_ExpireTime = 1800               
                case "3":### warning
                    $SEV_KEY = $OS_EventId + "_warning"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "4":### minor
                    $SEV_KEY = $OS_EventId + "_minor"
                    $DEFAULT_Severity = 3
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "5":### major
                    $SEV_KEY = $OS_EventId + "_major"
                    $DEFAULT_Severity = 4
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "6":### critical
                    $SEV_KEY = $OS_EventId + "_critical"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "7":### fatal
                    $SEV_KEY = $OS_EventId + "_fatal"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                default: 
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0
            }
                     
			update(@Severity)
			
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
            $vmwEnvPerceivedSeverity = $vmwEnvPerceivedSeverity + " ( " + $4 + " )"
            $vmwEnvAlertType = $vmwEnvAlertType + " ( " + $5 + " )"
            $vmwEnvAlertingFormat = $vmwEnvAlertingFormat + " ( " + $8 + " )"
 			details($vmwEnvDescription, $vmwEnvEventTime, $vmwEnvIndicationTime, $vmwEnvPerceivedSeverity, $vmwEnvAlertType, $vmwEnvSysCreationClassName, $vmwEnvAlertingElement, $vmwEnvAlertingFormat, $vmwEnvSystemName, $vmwEnvProviderName)
         
        case "309": ### vmwESXEnvMemoryAlert
        
            ##########
            # $1 = vmwEnvDescription
            # $2 = vmwEnvEventTime
            # $3 = vmwEnvIndicationTime
            # $4 = vmwEnvPerceivedSeverity
            # $5 = vmwEnvAlertType
            # $6 = vmwEnvSysCreationClassName
            # $7 = vmwEnvAlertingElement
            # $8 = vmwEnvAlertingFormat
            # $9 = vmwEnvSystemName
            # $10 = vmwEnvProviderName
            ##########
            
            $vmwEnvDescription = $1
            $vmwEnvEventTime = $2
            $vmwEnvIndicationTime = $3
            $vmwEnvPerceivedSeverity = lookup($4, VmwCIMSeverity)
            $vmwEnvAlertType = lookup($5, VmwCIMAlertTypes)
            $vmwEnvSysCreationClassName = $6
            $vmwEnvAlertingElement = $7
            $vmwEnvAlertingFormat = lookup($8, VmwCIMAlertFormat)
            $vmwEnvSystemName = $9
            $vmwEnvProviderName = $10
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXEnvMemoryAlert"

            @AlertGroup = "IPMI Memory Alert"
            @AlertKey = "ID : " + $vmwEnvAlertingElement
            @Summary = "IPMI Memory Alert from CIM, Type: " + $vmwEnvAlertType + "," + "Description: " + $vmwEnvDescription + " ( " + @AlertKey + " ) "
            
            switch($4)
            {
                case "0":### unknown
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "1":### other
                    $SEV_KEY = $OS_EventId + "_other"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "2":### information
                    $SEV_KEY = $OS_EventId + "_information"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 13
                    $DEFAULT_ExpireTime = 1800               
                case "3":### warning
                    $SEV_KEY = $OS_EventId + "_warning"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "4":### minor
                    $SEV_KEY = $OS_EventId + "_minor"
                    $DEFAULT_Severity = 3
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "5":### major
                    $SEV_KEY = $OS_EventId + "_major"
                    $DEFAULT_Severity = 4
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "6":### critical
                    $SEV_KEY = $OS_EventId + "_critical"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "7":### fatal
                    $SEV_KEY = $OS_EventId + "_fatal"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                default: 
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0
            }
                     
			update(@Severity)
			
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
            $vmwEnvPerceivedSeverity = $vmwEnvPerceivedSeverity + " ( " + $4 + " )"
            $vmwEnvAlertType = $vmwEnvAlertType + " ( " + $5 + " )"
            $vmwEnvAlertingFormat = $vmwEnvAlertingFormat + " ( " + $8 + " )"
 			details($vmwEnvDescription, $vmwEnvEventTime, $vmwEnvIndicationTime, $vmwEnvPerceivedSeverity, $vmwEnvAlertType, $vmwEnvSysCreationClassName, $vmwEnvAlertingElement, $vmwEnvAlertingFormat, $vmwEnvSystemName, $vmwEnvProviderName)
         
        case "310": ### vmwESXEnvBIOSAlert
        
            ##########
            # $1 = vmwEnvDescription
            # $2 = vmwEnvEventTime
            # $3 = vmwEnvIndicationTime
            # $4 = vmwEnvPerceivedSeverity
            # $5 = vmwEnvAlertType
            # $6 = vmwEnvSysCreationClassName
            # $7 = vmwEnvAlertingElement
            # $8 = vmwEnvAlertingFormat
            # $9 = vmwEnvSystemName
            # $10 = vmwEnvProviderName
            ##########
            
            $vmwEnvDescription = $1
            $vmwEnvEventTime = $2
            $vmwEnvIndicationTime = $3
            $vmwEnvPerceivedSeverity = lookup($4, VmwCIMSeverity)
            $vmwEnvAlertType = lookup($5, VmwCIMAlertTypes)
            $vmwEnvSysCreationClassName = $6
            $vmwEnvAlertingElement = $7
            $vmwEnvAlertingFormat = lookup($8, VmwCIMAlertFormat)
            $vmwEnvSystemName = $9
            $vmwEnvProviderName = $10
            
            $OS_EventId = "SNMPTRAP-vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXEnvBIOSAlert"

            @AlertGroup = "BIOS System Event Log Alert"
            @AlertKey = "ID : " + $vmwEnvAlertingElement
            @Summary = "BIOS System Event Log Alert from CIM, Type: " + $vmwEnvAlertType + "," + "Description: " + $vmwEnvDescription + " ( " + @AlertKey + " ) "
            
            switch($4)
            {
                case "0":### unknown
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "1":### other
                    $SEV_KEY = $OS_EventId + "_other"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "2":### information
                    $SEV_KEY = $OS_EventId + "_information"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 13
                    $DEFAULT_ExpireTime = 1800               
                case "3":### warning
                    $SEV_KEY = $OS_EventId + "_warning"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "4":### minor
                    $SEV_KEY = $OS_EventId + "_minor"
                    $DEFAULT_Severity = 3
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "5":### major
                    $SEV_KEY = $OS_EventId + "_major"
                    $DEFAULT_Severity = 4
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "6":### critical
                    $SEV_KEY = $OS_EventId + "_critical"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                case "7":### fatal
                    $SEV_KEY = $OS_EventId + "_fatal"
                    $DEFAULT_Severity = 5
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0               
                default: 
                    $SEV_KEY = $OS_EventId + "_unknown"
                    $DEFAULT_Severity = 2
                    $DEFAULT_Type = 1
                    $DEFAULT_ExpireTime = 0
            }
                     
			update(@Severity)
			
            @Identifier = @Node + " " + @AlertKey + " " + @AlertGroup + " " + $DEFAULT_Type + " " + @Agent + " " + @Manager + " " + $specific-trap
            
            $vmwEnvPerceivedSeverity = $vmwEnvPerceivedSeverity + " ( " + $4 + " )"
            $vmwEnvAlertType = $vmwEnvAlertType + " ( " + $5 + " )"
            $vmwEnvAlertingFormat = $vmwEnvAlertingFormat + " ( " + $8 + " )"
 			details($vmwEnvDescription, $vmwEnvEventTime, $vmwEnvIndicationTime, $vmwEnvPerceivedSeverity, $vmwEnvAlertType, $vmwEnvSysCreationClassName, $vmwEnvAlertingElement, $vmwEnvAlertingFormat, $vmwEnvSystemName, $vmwEnvProviderName)
         
        default:

            @Summary = "Unknown Specific Trap Number (" + $specific-trap + ") Received for Enterprise " + $enterprise
            @Severity = 1
            @Identifier = @Node + " " + @Agent + " " + @Manager + " " + $enterprise + " " + $generic-trap + " " + $specific-trap
            details($*)
    }



##########
# Handle Severity via Lookup.
##########

if(exists($SEV_KEY))
{
    [$OS_Severity,$OS_Type,$OS_ExpireTime] = lookup($SEV_KEY, vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB_sev)
}
else
{
    [$OS_Severity,$OS_Type,$OS_ExpireTime] = lookup($OS_EventId, vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB_sev)
}
include "$NC_RULES_HOME/include-common/AssignSev.include.common.rules"

##########
# End of Severity via Lookup.
##########

# For all the VM events if the actual VM name is replaced by the Moved Id code then it means it
# references a VM that is no longer on this machine and so we can discard the stale informantion.
if (regmatch($vmwVmDisplayName,"MoId: [0-9]+"))
{
    discard
    # The main event may have been discarded but the following include produces a genevent 
    # which could still fire so let put that in an else clause. 
}
else 
{
    # Include file to populate vmstatus table. Only needed if virtual management via SNMP is required.
    include "$NC_RULES_HOME/include-snmptrap/vmware/vmware-vmstatus-update.include.snmptrap.rules"
}

##########
# Enter "Advanced" and "User" includes.
##########


include "$NC_RULES_HOME/include-snmptrap/vmware/vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXNotifications.adv.include.snmptrap.rules"
include "$NC_RULES_HOME/include-snmptrap/vmware/vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB-vmwESXNotifications.user.include.snmptrap.rules"


##########
# End of "Advanced" and "User" includes.
##########

include "$NC_RULES_HOME/include-common/load_include.rules"

log(DEBUG, "<<<<< Leaving... vmware-VMWARE-ENV-MIB-VMWARE-VMINFO-MIB.include.snmptrap.rules >>>>>")


